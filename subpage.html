<!DOCTYPE html>
<html>
	<head>
		<title>Materia Abierta 2022</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" href="/static/css/main.css">
		<!-- <script src="/static/js/global.js"></script> -->
		<!-- <script src="/static/js/ui.js"></script> -->
	</head>
	<body>
		<div id="background"></div>
        <span><a id='title' href='/'>Materia Abierta</a> / </span><br><br><br>
		<div id="content"></div>
		<script>
			let searchParams = new URLSearchParams(window.location.search);
			var lang = searchParams.get('lang') !== null ? searchParams.get('lang') : 'es';
			var page = searchParams.get('page') !== null ? searchParams.get('page') : '404';
			var synopsis_pattern = /\[synopsis\]\((.*?)\)/;
			var sContent = document.getElementById('content');
			var sBackground = document.getElementById('background');
			var body = document.body;
			var bodyClass = '';

			var request_page = new XMLHttpRequest();
			request_page.open('GET', 'content/'+lang+'/'+page+'.txt');
			request_page.onreadystatechange = function() {
				if(request_page.readyState == 4)
				{
					if (request_page.status === 200) {
						// let r = new RegExp(synopsis_pattern);
						sContent.innerHTML = request_page.responseText.replace(synopsis_pattern, '');
					}
				}
			}
			request_page.send();

			var request_weather = new XMLHttpRequest();
			request_weather.onreadystatechange = function(){
				if (request_weather.readyState === 4) {
					if (request_weather.status === 200) { 
						try{
		                    // console.log(data);
		                    // wind_mph
		                    // wind_dir
							var data= JSON.parse(request_weather.responseText)['current'];
							let cloud = data['cloud'] > 99 ? 99 : data['cloud'];
							cloud = '40';
							console.log(cloud);
							if(cloud != 0)
							{
								let cloud_percent = 50 - cloud / 2;
								// cloud_percent = 20;
								let deg = typeof data['wind_degree'] == 'undefined' ? 180 : data['wind_degree'];
								let gradient = 'linear-gradient('+deg+'deg, blue '+cloud_percent+'%, white '+((50 - cloud_percent) / 2 + cloud_percent)+'%, white '+(100 - ((50 - cloud_percent) / 2 + cloud_percent))+'%, blue '+(100 - cloud_percent)+'%)';
								sBackground.style.backgroundImage = gradient;
							}
							if(typeof data['temp_f'] != 'undefined')
							{
								let temp = data['temp_f'];
								let temp_max = 76;
								let temp_min = 38;
								// let hue =  (parseInt((temp - 38) / (76 - 38) * 360) + 180) % 360;
								let hue =  (parseInt((temp - 38) / (76 - 38) * 360) + 180) % 360;
								var r = document.querySelector(':root');
								console.log(hue);
								r.style.setProperty('--text-color', 'hsl('+hue+', 20%, 50%)');
							}
						}
						catch(err)
						{
							console.log('Error!');
							console.log(err);
							return false;
						}
					}
				}
			};
			request_weather.open('GET', location.protocol + '//api.weatherapi.com/v1/current.json?key=5262904081d248dc9d6134509221701&q=Mexico City');
			request_weather.send();
		</script>
	</body>
</html>
