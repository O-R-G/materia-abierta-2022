<!DOCTYPE html>
<html>
<head>
	<title>Materia Abierta 2022</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<link rel="stylesheet" href="/static/css/main.css">
</head>
<body>
	<div id="background"></div>
	<span><a id='title' href='/'>Materia Abierta</a> / <span class="sans">Right now, it is 24° C with some clouds here.</span></span><br><br><br>
    <span id='intro'>
        <i>This is a website for </i><b>The Rise of the Coyote</b>. <i>A website is (also written as web site) is a collection of web pages 
identified by  a common domain name (<a href='/'>www.materiaabierta.com</a>) and published on a web server. This webserver is a computer situated in <a href='/media/San_pedro_atocpan.gif'>Milpa Alta, Ciudad de México</a>.</i>    

<b>Right now, it is <span id="temp">24</span>° C with some clouds here.</b>

    </span>
	<span id="content"></span>
	<div id="badge"><img src="media/server.jpg"></div>
<span id='outro'>    
<i>The world wide web was designed as a two-way medium, hosts and clients.</i>
</span>
<div id="menu-container">
	<div id="menu-btn" onclick="toggleMenu()" class="sans">MENU</div>
	<div id="menu">
	</div>
</div>
<div id="geolocation" class="sans">14Q 497564.17806281 2122128.6424549</div>
<script>
	let searchParams = new URLSearchParams(window.location.search);
	var sketch_version = searchParams.get('sketch') !== null ? searchParams.get('sketch') : 0;
	document.body.setAttribute('sketch', sketch_version);
	function toggleMenu(){
		document.body.classList.toggle('viewing-menu');
	}
	let sMenu = document.getElementById('menu');
	var lang = searchParams.get('lang') !== null ? searchParams.get('lang') : 'es';
	var fullContent = '';
	var match = [];
	var filenames_all = {
		'es':[
			'Verano 2022',
			'The Rise of the Coyote',
			'Xochimilco y Milpa Alta',
			'Aplicación',
			'Calendario',
			'Contacto',
			'Costo',
			'Créditos',
			'Docentes',
			'Participantes',
			'Resumen curatorial',
			'Semblanzas'
		]
	};
	filenames = filenames_all[lang];
	filenames.forEach((el, i) => {
		let menuItem = document.createElement('DIV');
		menuItem.classList = 'menu-item sans';
		let menuItemLink = document.createElement('A');
		menuItemLink.innerText = el;
		menuItemLink.href = '/' + lang + '/' + el + '.html';
		menuItem.appendChild(menuItemLink);
		sMenu.appendChild(menuItem);
	});
	var loadedCount = 0;
	var request_content = [];
	var body = document.body;
	var bodyClass = '';
	var sContent = document.getElementById('content');
	var sBackground = document.getElementById('background');
	var r = document.querySelector(':root');
	// var synopsis_pattern = /\[synopsis\]\((.*?)\)/;
	var synopsis_pattern = /\<span\s*class\s*?=\s*?\"(?:.*?\s+)?subpage-synopsis(?:\s+.*?)?"\>(.*?)\<\/span\>/;
	function shuffle(array) {
		let currentIndex = array.length,  randomIndex;
		// While there remain elements to shuffle...
		while (currentIndex != 0) {
			// Pick a remaining element...
			randomIndex = Math.floor(Math.random() * currentIndex);
			currentIndex--;
			// And swap it with the current element.
			[array[currentIndex], array[randomIndex]] = [
				array[randomIndex], array[currentIndex]];
		}
		return array;
	};
	filenames = shuffle(filenames);
	filenames.forEach((el, i) => {
		request_content[i] = new XMLHttpRequest();
		// let filename = el.substring(1, el.length - 2);
		request_content[i].open('GET', lang+'/'+el+'.html');
		request_content[i].onreadystatechange = function() {
			if(request_content[i].readyState == 4)
			{
				if (request_content[i].status === 200) {
					// let r = new RegExp(synopsis_pattern);
					let match = request_content[i].responseText.match(synopsis_pattern);
					// let url = 'subpage.html?lang='+lang+'&page='+el;
					let url = lang + '/' + el + '.html';
					if(match && match.length > 1)
					{
						fullContent += '<span class="section-content"><a class="section-title" href="'+url+'">'+filenames[i] + '</a> ' + match[1] + '</span> ';
					}
					loadedCount++;
						if(loadedCount == filenames.length)
							sContent.innerHTML = fullContent;
				}
			}
		}
		request_content[i].send();
	});


</script>
<script src="/static/js/weather.js"></script>
</body>
</html>
